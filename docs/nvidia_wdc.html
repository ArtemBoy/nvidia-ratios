<!DOCTYPE html>
<html>
<head>
  <title>Nvidia Full Financials Data WDC</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tableauwdc/2.3.0/tableauwdc.min.js"></script>
</head>
<body>
  <h2>Loading Nvidia Full Financials Data...</h2>

  <script>
    (function () {
      const connector = tableau.makeConnector();

      connector.getSchema = function (schemaCallback) {
        fetch("https://artemboy.github.io/nvidia-ratios/data/nvidia_full_data.csv")
          .then(response => response.text())
          .then(text => {
            const lines = text.split("\n").filter(line => line.trim() !== "");
            const headers = lines[0].split(",");
            const cols = headers.map(col => ({
              id: col.trim().replace(/\W/g, "_"), // clean header names
              dataType: tableau.dataTypeEnum.string
            }));

            const schema = {
              id: "nvidia_full_data",
              alias: "Nvidia Full Financials",
              columns: cols
            };

            schemaCallback([schema]);
          })
          .catch(error => tableau.abortWithError("Schema fetch error: " + error));
      };

      connector.getData = function (table, doneCallback) {
        fetch("https://artemboy.github.io/nvidia-ratios/data/nvidia_full_data.csv")
          .then(response => response.text())
          .then(text => {
            const lines = text.split("\n").filter(line => line.trim() !== "");
            const headers = lines[0].split(",");
            const data = lines.slice(1).map(line => {
              const values = line.split(",");
              const row = {};
              headers.forEach((header, index) => {
                row[header.trim().replace(/\W/g, "_")] = values[index]?.trim();
              });
              return row;
            });

            table.appendRows(data);
            doneCallback();
          })
          .catch(error => tableau.abortWithError("Data fetch error: " + error));
      };

      tableau.registerConnector(connector);

      window.onload = function () {
        tableau.connectionName = "Nvidia Full Financials Data";
        tableau.submit();
      };
    })();
  </script>
</body>
</html>
