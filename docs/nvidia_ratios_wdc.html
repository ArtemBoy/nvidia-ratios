<!DOCTYPE html>
<html>
<head>
  <title>Nvidia Full Financials WDC</title>
  <script src="https://connectors.tableau.com/libs/tableauwdc-2.3.latest.js"></script>
</head>
<body>
  <h2>Loading Nvidia Full Financials Data...</h2>
  <script>
    (function () {
      var myConnector = tableau.makeConnector();

      myConnector.getSchema = function (schemaCallback) {
        fetch("https://artemboy.github.io/nvidia-ratios/data/nvidia_full_data.csv")
          .then(response => response.text())
          .then(text => {
            const lines = text.split("\n").filter(Boolean);
            const headers = lines[0].split(",").map(h => h.trim());
            const cols = headers.map(h => ({
              id: h.replace(/\s+/g, "_"),
              alias: h,
              dataType: tableau.dataTypeEnum.string
            }));
            schemaCallback([{
              id: "nvidia_full_data",
              alias: "Nvidia Financial Statement Data",
              columns: cols
            }]);
          });
      };

      myConnector.getData = function (table, doneCallback) {
        fetch("https://artemboy.github.io/nvidia-ratios/data/nvidia_full_data.csv")
          .then(response => response.text())
          .then(text => {
            const lines = text.split("\n").filter(Boolean);
            const headers = lines[0].split(",").map(h => h.trim());
            const rows = lines.slice(1).map(line => {
              const values = line.split(",");
              let rowObj = {};
              headers.forEach((h, i) => {
                rowObj[h.replace(/\s+/g, "_")] = values[i];
              });
              return rowObj;
            });
            table.appendRows(rows);
            doneCallback();
          });
      };

      tableau.registerConnector(myConnector);
      tableau.initCallback = () => tableau.submit();
    })();
  </script>
</body>
</html>
